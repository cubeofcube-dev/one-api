# Internationalization (i18n) Strategy for Modern Frontend

This document outlines the strategy and implementation guide for internationalization (i18n) in the `web/modern` frontend application.

## 1. Architecture Overview

We use **[i18next](https://www.i18next.com/)** and **[react-i18next](https://react.i18next.com/)** for handling translations. This stack provides a robust solution for:

- Loading translations.
- Detecting user language.
- Caching language preference.
- React hooks for easy usage.

### Key Features

- **Library**: `i18next`, `react-i18next`, `i18next-browser-languagedetector`.
- **Storage**: Language preference is persisted in `localStorage` under the key `i18nextLng`.
- **Fallback**:
  1. User's saved preference.
  2. Browser's detected language.
  3. Default fallback: English (`en`).
- **File Structure**:

  ```text
  src/
  ├── i18n/
  │   ├── index.ts          # Configuration entry point
  │   └── locales/          # Translation files
  │       ├── en.json
  │       ├── zh.json
  │       ├── fr.json
  │       ├── es.json
  │       └── ja.json
  ```

## 2. Implementation Guide

Follow these steps to implement i18n in the application.

### Step 1: Verify Dependencies

Ensure the following packages are installed (they should already be in `package.json`):

```bash
npm install i18next react-i18next i18next-browser-languagedetector
```

### Step 2: Create Translation Files

Create the directory structure `src/i18n/locales` and add the initial JSON files for the supported languages.

**`src/i18n/locales/en.json`** (English)

```json
{
  "common": {
    "welcome": "Welcome to One API",
    "login": "Login",
    "register": "Register",
    "settings": "Settings",
    "language": "Language"
  }
}
```

**`src/i18n/locales/zh.json`** (Simplified Chinese)

```json
{
  "common": {
    "welcome": "欢迎使用 One API",
    "login": "登录",
    "register": "注册",
    "settings": "设置",
    "language": "语言"
  }
}
```

_Create similar files for `fr.json` (French), `es.json` (Spanish), and `ja.json` (Japanese)._

### Step 3: Configure i18next

Create the configuration file **`src/i18n/index.ts`**.

```typescript
import i18n from "i18next";
import { initReactI18next } from "react-i18next";
import LanguageDetector from "i18next-browser-languagedetector";

import en from "./locales/en.json";
import zh from "./locales/zh.json";
import fr from "./locales/fr.json";
import es from "./locales/es.json";
import ja from "./locales/ja.json";

// Define the resources
const resources = {
  en: { translation: en },
  zh: { translation: zh },
  fr: { translation: fr },
  es: { translation: es },
  ja: { translation: ja },
};

i18n
  // Detect user language
  .use(LanguageDetector)
  // Pass the i18n instance to react-i18next
  .use(initReactI18next)
  // Init i18next
  .init({
    resources,
    fallbackLng: "en", // Default fallback
    debug: process.env.NODE_ENV === "development",

    interpolation: {
      escapeValue: false, // React already safes from xss
    },

    detection: {
      // Order and from where user language should be detected
      order: ["localStorage", "navigator"],
      // Keys or params to lookup language from
      lookupLocalStorage: "i18nextLng",
      // Cache user language on
      caches: ["localStorage"],
    },
  });

export default i18n;
```

### Step 4: Initialize in Main Entry

Import the i18n configuration in **`src/main.tsx`** before rendering the app.

```typescript
import React from "react";
import ReactDOM from "react-dom/client";
// ... other imports
import "./i18n"; // Import i18n config here

ReactDOM.createRoot(document.getElementById("root")!)
  .render
  // ...
  ();
```

### Step 5: Usage in Components

Use the `useTranslation` hook to translate text.

```tsx
import { useTranslation } from "react-i18next";

export function MyComponent() {
  const { t } = useTranslation();

  return (
    <div>
      <h1>{t("common.welcome")}</h1>
      <button>{t("common.login")}</button>
    </div>
  );
}
```

### Step 6: Language Selector Component

Create a component to allow users to switch languages.

**`src/components/LanguageSelector.tsx`**

```tsx
import { useTranslation } from "react-i18next";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";

const languages = [
  { code: "en", label: "English" },
  { code: "zh", label: "简体中文" },
  { code: "fr", label: "Français" },
  { code: "es", label: "Español" },
  { code: "ja", label: "日本語" },
];

export function LanguageSelector() {
  const { i18n } = useTranslation();

  const handleLanguageChange = (value: string) => {
    i18n.changeLanguage(value);
  };

  return (
    <Select value={i18n.language} onValueChange={handleLanguageChange}>
      <SelectTrigger className="w-[180px]">
        <SelectValue placeholder="Select Language" />
      </SelectTrigger>
      <SelectContent>
        {languages.map((lang) => (
          <SelectItem key={lang.code} value={lang.code}>
            {lang.label}
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  );
}
```

## 3. Adding New Languages

To add a new language (e.g., German `de`):

1. Create `src/i18n/locales/de.json`.
2. Import the file in `src/i18n/index.ts`.
3. Add it to the `resources` object in `src/i18n/index.ts`.
4. Add the language option to the `languages` array in `src/components/LanguageSelector.tsx` (or wherever the list is maintained).

## 4. Best Practices

- **Keys**: Use nested keys for better organization (e.g., `page.home.title`, `common.button.save`).
- **Placeholders**: Use `{{variable}}` for dynamic values.
- **Splitting**: For very large apps, consider splitting translations into multiple files (namespaces) and loading them lazily, though a single file per language is sufficient for now.
